if (self.CavalryLogger) { CavalryLogger.start_js(["eujCn"]); }

__d("RTISubscriptionManager",["ChannelEventEmitter","ChannelEventType","ErrorUtils","RTISubscriptionManagerConfig","SkywalkerUtils","Stratcom","invariant"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";__p&&__p();var n={SUBSCRIBE:"s",UNSUBSCRIBE:"u"},o=300;function a(){__p&&__p();this.$1={};this.$2=!1;this.$3=!1;this.$4=!0;this.$5=document.readyState==="complete";if(!this.$5)var a=l.listen(["m:onload"],null,function(b){a.remove(),this.$5=!0,this.flush()}.bind(this));this.$6=null;g.addListener(h.RTI_SESSION,function(a){this.$6=a,this.$6&&(this.deleteSubscriptions(function(a){return a.getState()===n.UNSUBSCRIBE}),this.flush())}.bind(this));g.addListener(h.SKYWALKER_MESSAGE,function(a){var b=a.topic,c=this.$1[b];if(c&&c.getState()===n.SUBSCRIBE){a={payload:a.payload,topic:b};i.applyWithGuard(c.getMessageListener(),this,[a])}}.bind(this));this.getCurrentSession()}a.prototype.subscribe=function(a,b,c,d,e,f){__p&&__p();a||m(0,782);b||m(0,783);if(Object.keys(this.$1).length<this.getMaxSubscriptions()){c=k.patchContext(c||{});b=new q(a,b,c,d,e,f);c=new p(b);this.$1[a]=b;this.flush();return c}throw new Error("Exceeded max subscription count")};a.prototype.unsubscribe=function(a){a||m(0,782);if(a in this.$1){a=this.$1[a];a.setState(n.UNSUBSCRIBE);a.setDirty(!0);a.setSent(!1)}};a.prototype.flush=function(){__p&&__p();if(this.isReady()&&!this.$2){this.$2=!0;this.$3=!1;var a=[],b={},c=!1;this.forEachSubscription(function(d,e){__p&&__p();if(e.isDirty()){d="subscriptions";var f=b[d];f||(f=[],b[d]=f);a.push(e);e.setDirty(!1);e.setSent(!1);d={topic:e.getTopic(),state:e.getState(),context:e.getContext()};f.push(d)}else c=!0});if(!c&&b.subscriptions&&b.subscriptions.length>0){var d=[];for(var e=0;e<b.subscriptions.length;e++)b.subscriptions[e].state!==n.UNSUBSCRIBE&&d.push(b.subscriptions[e]);b.subscriptions=d;this.$4=!0}e=function(b){__p&&__p();var c=b.data!=null;this.$4&&c&&(this.$4=!1);for(var d=0;d<a.length;d++){var e=a[d];e.setSent(c);e.setDirty(!c);if(e.getState()===n.SUBSCRIBE){var f=e.getSubscribeCallback();f!=null&&i.applyWithGuard(f,this,[b])}else if(e.getState()===n.UNSUBSCRIBE){f=e.getUnsubscribeCallback();f!=null&&i.applyWithGuard(f,this,[b])}}this.deleteSubscriptions(function(a){return a.getState()===n.UNSUBSCRIBE&&a.isSent()});this.$2=!1;this.$3&&(this.$3=!1,this.flush())}.bind(this);if(Object.keys(b).length>0){d={};this.$4&&(d.reset="t");this.$6!=null&&this.$6.issueRequest("/sub",d,b,e)}else this.$2=!1}else this.$3=!0,this.$6===null&&this.getCurrentSession()};a.prototype.deleteSubscriptions=function(a){a||m(0,2900);var b=[];this.forEachSubscription(function(c,d){a.apply(this,[d])&&b.push(c)});for(var c=0;c<b.length;c++)delete this.$1[b[c]]};a.prototype.forEachSubscription=function(a){a||m(0,2901);for(var b in this.$1)Object.prototype.hasOwnProperty.call(this.$1,b)&&a.apply(this,[b,this.$1[b]])};a.prototype.getSubscriptions=function(){var a=[];this.forEachSubscription(function(b,c){a.push(c)});return a};a.prototype.isSubscribed=function(a){a||m(0,782);return a in this.$1};a.prototype.isReady=function(){return this.$6!==null&&this.$5};a.prototype.getCurrentSession=function(){g.emit(h.GET_RTI_SESSION_REQUEST)};a.prototype.getMaxSubscriptions=function(){if(j.config&&Object.prototype.hasOwnProperty.call(j.config,"max_subscriptions"))return j.config.max_subscriptions;else return o};function p(a){this.$1=a}p.prototype.unsubscribe=function(){var a=this.$1.getUnsubscribeHook();a&&a();r.unsubscribe(this.$1.getTopic())};p.prototype.getContext=function(){return this.$1.getContext()};p.prototype.handleLifecycles=function(a){};function q(a,b,c,d,e,f){this.$1=a,this.$2=b,this.$3=!0,this.$4=!1,this.$5=n.SUBSCRIBE,this.$6=Date.now(),c?this.$7=c:this.$7={},this.$8=d,this.$9=e,this.$10=f}q.prototype.getCreatedTime=function(){return this.$6};q.prototype.getTopic=function(){return this.$1};q.prototype.getMessageListener=function(){return this.$2};q.prototype.getSubscribeCallback=function(){return this.$8};q.prototype.getUnsubscribeHook=function(){return this.$9};q.prototype.getUnsubscribeCallback=function(){return this.$10};q.prototype.isDirty=function(){return this.$3};q.prototype.setDirty=function(a){this.$3=a};q.prototype.isAlive=function(){return this.$5!==n.UNSUBSCRIBE};q.prototype.getState=function(){return this.$5};q.prototype.setState=function(a){this.$5=a};q.prototype.getContext=function(){return this.$7};q.prototype.isSent=function(){return this.$4};q.prototype.setSent=function(a){this.$4=a};var r=new a();e.exports=r}),null);